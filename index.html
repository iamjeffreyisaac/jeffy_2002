<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rhea ‚ù§Ô∏è</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#070012;
    --bg2:#120033;
    --neon1:#6a00ff;
    --neon2:#00d8ff;
    --pink:#ff2bd4;
    --glass: rgba(255,255,255,0.04);
  }
  *{box-sizing:border-box}
  body{
    margin:0; height:100vh; font-family:'Poppins',sans-serif; color:#e8e8ff;
    background: radial-gradient(circle at 10% 10%, rgba(15,5,40,0.6), transparent 20%), linear-gradient(135deg,var(--bg1),var(--bg2));
    display:flex; align-items:center; justify-content:center; overflow:hidden;
  }
  .stage{
    width:75vw; height:75vh; max-width:1100px; max-height:820px; min-width:540px; min-height:420px;
    position:relative; border-radius:16px; overflow:hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.6), inset 0 0 80px rgba(107,0,255,0.06);
    border: 1px solid rgba(255,255,255,0.03);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0));
  }
  canvas{display:block; width:100%; height:100%; background:transparent}

  /* start / win overlays */
  .overlay{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:40; pointer-events:auto;
  }
  .card{
    width:78%; max-width:760px; text-align:center; backdrop-filter: blur(6px);
    background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:28px;
    border: 1px solid rgba(109,0,255,0.12); box-shadow: 0 10px 40px rgba(106,0,255,0.12);
  }
  .title{font-size:36px; margin:0 0 8px; color:var(--neon1); text-shadow: 0 0 18px rgba(106,0,255,0.35)}
  .subtitle{font-size:14px; margin:0 0 18px; color: #b9b4ff}
  .big-btn{padding:12px 28px; font-size:18px; border-radius:10px; border:none; cursor:pointer; background:linear-gradient(90deg,var(--neon1),var(--neon2)); color:white; box-shadow:0 10px 30px rgba(106,0,255,0.15);}
  .small-btn{padding:8px 12px; border-radius:8px; border:none; cursor:pointer; background:transparent; color:#e8e8ff}

  #hud{position:absolute; left:18px; top:16px; z-index:30; font-weight:600; text-shadow:0 0 8px rgba(0,0,0,0.6)}
  #scoreBubble{display:inline-block; padding:8px 12px; background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border-radius:12px; border:1px solid rgba(255,255,255,0.03)}

  #musicControl{position:absolute; right:16px; top:14px; z-index:30}
  .music-btn{padding:8px 14px; border-radius:12px; background:linear-gradient(90deg,var(--neon1),var(--neon2)); color:white; border:none; box-shadow:0 8px 24px rgba(0,0,0,0.4); cursor:pointer}

  /* floating score animation container */
  .floatingScore{
    position:absolute; left:50%; transform:translateX(-50%); top:14px; z-index:30; pointer-events:none;
  }

  /* win message style */
  .winText{font-size:20px; color:var(--pink); text-shadow:0 0 20px rgba(255,43,212,0.25)}

  /* touch controls - mobile */
  .touchControls{position:absolute; bottom:16px; left:50%; transform:translateX(-50%); z-index:35; display:flex; gap:10px}
  .dpad{width:140px; height:90px; display:grid; grid-template-columns:repeat(3,1fr); grid-template-rows:repeat(2,1fr); gap:6px; background:transparent}
  .btn-ctrl{border-radius:10px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.03); padding:8px}

  @media(max-width:700px){ .stage{width:94vw; height:86vh; min-width:320px} .title{font-size:28px} }

</style>
</head>
<body>
  <div class="stage" id="stage">
    <div id="hud"><span id="scoreBubble">Hearts: <span id="score">0</span></span></div>
    <div id="musicControl"><button id="musicBtn" class="music-btn">Play Kannamma üéµ</button></div>

    <canvas id="gameCanvas"></canvas>

    <div class="overlay" id="startOverlay">
      <div class="card">
        <h1 class="title">Rhea üíú, Hi sweetheart</h1>
        <p class="subtitle">A small game ‚Äî collect hearts and read my message.</p>
        <div style="display:flex; gap:12px; justify-content:center;">
          <button class="big-btn" id="startBtn">Start Game</button>
          <button class="small-btn" id="howBtn">How to play</button>
        </div>
      </div>
    </div>

    <div class="overlay" id="winOverlay" style="display:none;">
      <div class="card">
        <h1 class="title">You did it ‚ù§Ô∏è</h1>
        <p class="winText">"Hi sweetheart,<br>Its been a month since we started dating.<br>Feels like ive been with you for soooo long<br>Maybe because I enjoy your presence.<br>Your smile<br>Your whole existence of you being in this universe as the same time as me makes me feel special so dont ever think that you dont do enough for me.<br>I love you"</p>
        <div style="margin-top:18px">
          <button class="big-btn" id="playAgain">Play Again</button>
        </div>
      </div>
    </div>

    <div class="floatingScore" id="floatContainer"></div>

    <div class="overlay" id="howOverlay" style="display:none;">
      <div class="card">
        <h2 style="color:var(--neon2)">How to play</h2>
        <p class="subtitle">Arrow keys or WASD to move. Collect 12 hearts.</p>
        <button class="big-btn" id="closeHow">Got it</button>
      </div>
    </div>

    <div class="touchControls" id="touchControls" style="display:none;">
      <div class="dpad">
        <div></div><div class="btn-ctrl" data-dir="up">‚ñ≤</div><div></div>
        <div class="btn-ctrl" data-dir="left">‚óÄ</div><div class="btn-ctrl" data-dir="down">‚ñº</div><div class="btn-ctrl" data-dir="right">‚ñ∂</div>
      </div>
    </div>

  </div>

  <!-- background music: put kannamma.mp3 in same folder -->
  <audio id="bgMusic" loop preload="auto">
    <source src="kannamma.mp3" type="audio/mpeg">
  </audio>

<script>
// Core game variables
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const stage = document.getElementById('stage');
const startOverlay = document.getElementById('startOverlay');
const winOverlay = document.getElementById('winOverlay');
const howOverlay = document.getElementById('howOverlay');
const startBtn = document.getElementById('startBtn');
const howBtn = document.getElementById('howBtn');
const closeHow = document.getElementById('closeHow');
const playAgain = document.getElementById('playAgain');
const scoreEl = document.getElementById('score');
const floatContainer = document.getElementById('floatContainer');
const musicBtn = document.getElementById('musicBtn');
const bgMusic = document.getElementById('bgMusic');
const touchControls = document.getElementById('touchControls');

let WIDTH, HEIGHT;
function resizeCanvas(){
  // canvas will be sized to the stage interior
  const rect = stage.getBoundingClientRect();
  canvas.width = Math.floor(rect.width);
  canvas.height = Math.floor(rect.height);
  WIDTH = canvas.width; HEIGHT = canvas.height;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Game state
let running = false;
let hearts = [];
let particles = [];
let trails = [];
let score = 0;
let targetScore = 12; // change to taste

// Player (small bike)
let player = {
  x: WIDTH/2, y: HEIGHT/2, w: 28, h: 12, angle:0, speed: 3.6, vx:0, vy:0, maxSpeed:4.4
};

// Controls
const keys = {};
window.addEventListener('keydown', e => { keys[e.key.toLowerCase()] = true; });
window.addEventListener('keyup', e => { keys[e.key.toLowerCase()] = false; });

// Touch controls for mobile
let touchDir = null;
Array.from(document.querySelectorAll('.btn-ctrl')).forEach(b => {
  b.addEventListener('touchstart', e => { e.preventDefault(); touchDir = b.dataset.dir; });
  b.addEventListener('touchend', e => { e.preventDefault(); touchDir = null; });
});

// Music control
let musicPlaying = false;
musicBtn.addEventListener('click', ()=>{
  if(!musicPlaying){ bgMusic.play().catch(()=>{}); musicPlaying = true; musicBtn.innerText='Pause Kannamma ‚è∏Ô∏è'; }
  else{ bgMusic.pause(); musicPlaying = false; musicBtn.innerText='Play Kannamma üéµ'; }
});

// helper: play small beep for scoring using WebAudio
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeep(){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type='sine'; o.frequency.value = 520;
  g.gain.value = 0.0001;
  o.connect(g); g.connect(audioCtx.destination);
  const now = audioCtx.currentTime; o.start(now);
  g.gain.exponentialRampToValueAtTime(0.08, now+0.02);
  g.gain.exponentialRampToValueAtTime(0.0001, now+0.35);
  o.stop(now+0.36);
}

// Spawn hearts
function spawnHeart(){
  const margin = 40;
  hearts.push({
    x: margin + Math.random()*(WIDTH-2*margin),
    y: margin + Math.random()*(HEIGHT-2*margin),
    r: 16 + Math.random()*6,
    glow: 0.8 + Math.random()*1.4,
    angle: 0
  });
}
let spawnTimer = 0;

// Particles & trails
function addParticle(x,y,dx,dy,col,life=40){ particles.push({x,y,dx,dy,col,life,age:0}); }
function addTrail(x,y,alpha=1){ trails.push({x,y,a:alpha,life:30,age:0}); }

// Draw functions
function drawBike(cx, cy, ang){
  // TVS Apache RR 310-inspired sportbike silhouette: sharper fairing, twin projector look
  ctx.save(); ctx.translate(cx,cy); ctx.rotate(ang);

  // ground shadow
  ctx.fillStyle = 'rgba(0,0,0,0.22)'; ctx.beginPath(); ctx.ellipse(6,16,34,10,0,0,Math.PI*2); ctx.fill();

  // rear wheel
  ctx.lineWidth=4; ctx.strokeStyle='#071a2a'; ctx.beginPath(); ctx.arc(-28,12,11,0,Math.PI*2); ctx.stroke();
  // front wheel
  ctx.beginPath(); ctx.arc(34,12,11,0,Math.PI*2); ctx.stroke();

  // angular fairing
  ctx.fillStyle='#6a00ff';
  ctx.beginPath();
  ctx.moveTo(-28,12);
  ctx.lineTo(-6,-8);
  ctx.lineTo(6,-14);
  ctx.lineTo(30,-8);
  ctx.lineTo(40,2);
  ctx.lineTo(14,18);
  ctx.lineTo(-28,12);
  ctx.closePath(); ctx.fill();

  // accent stripe
  ctx.strokeStyle='#00d8ff'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(-4,-6); ctx.lineTo(18,-4); ctx.stroke();

  // windshield - sharp
  ctx.fillStyle='rgba(90,230,255,0.9)'; ctx.beginPath(); ctx.moveTo(6,-12); ctx.lineTo(14,-22); ctx.lineTo(26,-10); ctx.closePath(); ctx.fill();

  // twin headlight impression
  ctx.fillStyle='#ffd86b'; ctx.beginPath(); ctx.ellipse(34,2,5,6,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle='#ffd86b'; ctx.beginPath(); ctx.ellipse(26,2,4,5,0,0,Math.PI*2); ctx.fill();

  // tail light
  ctx.fillStyle='#ff3db2'; ctx.beginPath(); ctx.ellipse(-32,6,5,3,0,0,Math.PI*2); ctx.fill();

  // small details
  ctx.fillStyle='#071a2a'; ctx.fillRect(2,8,10,4);

  ctx.restore();
}


  

function drawHeartShape(x,y,r,glow){
  ctx.save(); ctx.translate(x,y);
  ctx.beginPath();
  const s = r*0.06;
  ctx.moveTo(0,-r/4);
  ctx.bezierCurveTo(-r, -r/1.6, -r, r/2, 0, r);
  ctx.bezierCurveTo(r, r/2, r, -r/1.6, 0, -r/4);
  ctx.closePath();
  // glow
  ctx.shadowColor = 'rgba(255,43,212,0.9)'; ctx.shadowBlur = 18*glow;
  const g = ctx.createLinearGradient(-r,-r,r,r);
  g.addColorStop(0,'#ff8edc'); g.addColorStop(0.5,'#ff2bd4'); g.addColorStop(1,'#9b00ff');
  ctx.fillStyle = g; ctx.fill();
  ctx.shadowBlur = 0;
  ctx.restore();
}

// collision detection
function dist(a,b,c,d){ return Math.hypot(a-c,b-d); }

// scoring floating animation
function floatScore(text,x,y){
  const el = document.createElement('div');
  el.style.position='absolute'; el.style.left=(x)+'px'; el.style.top=(y)+'px'; el.style.transform='translate(-50%,-50%)';
  el.style.color='white'; el.style.fontWeight='700'; el.style.textShadow='0 0 18px rgba(106,0,255,0.6)';
  el.style.pointerEvents='none'; el.innerText=text;
  floatContainer.appendChild(el);
  // animate
  let t=0; const id=setInterval(()=>{
    t+=1; el.style.top=(y - t*2)+'px'; el.style.opacity = (1 - t/40); el.style.transform = `translate(-50%,-50%) scale(${1+ t/80})`;
    if(t>40){ clearInterval(id); el.remove(); }
  },16);
}

// main update + draw
function update(){
  // movement
  let ax=0, ay=0;
  if(keys['arrowup']||keys['w']||touchDir==='up') ay-=1;
  if(keys['arrowdown']||keys['s']||touchDir==='down') ay+=1;
  if(keys['arrowleft']||keys['a']||touchDir==='left') ax-=1;
  if(keys['arrowright']||keys['d']||touchDir==='right') ax+=1;

  // accelerate
  const mag = Math.hypot(ax,ay) || 0;
  if(mag>0){ ax/=mag; ay/=mag; player.vx += ax*0.35; player.vy += ay*0.35; }
  // friction
  player.vx *= 0.96; player.vy *= 0.96;
  // clamp speed
  const sp = Math.hypot(player.vx, player.vy);
  if(sp > player.maxSpeed){ player.vx = player.vx/sp * player.maxSpeed; player.vy = player.vy/sp * player.maxSpeed; }
  player.x += player.vx; player.y += player.vy;

  // keep inside
  player.x = Math.max(20, Math.min(WIDTH-20, player.x)); player.y = Math.max(20, Math.min(HEIGHT-20, player.y));

  // angle for bike tilt
  player.angle = Math.atan2(player.vy, player.vx);

  // spawn trails & particles when moving
  if(Math.hypot(player.vx, player.vy) > 0.4){
    addTrail(player.x-6, player.y+6, 0.9);
    for(let i=0;i<2;i++) addParticle(player.x-6 + Math.random()*6 -3, player.y+6 + Math.random()*6 -3, -player.vx*0.4 + (Math.random()-0.5)*0.6, -player.vy*0.4 + (Math.random()-0.5)*0.6, '#6a00ff', 30 + Math.random()*20);
  }

  // update particles
  for(let p of particles){ p.x += p.dx; p.y += p.dy; p.age++; }
  particles = particles.filter(p=>p.age < p.life);

  // update trails
  for(let t of trails){ t.age++; t.a = 1 - t.age/t.life; }
  trails = trails.filter(t => t.age < t.life);

  // hearts spawn
  spawnTimer += 1/60;
  if(spawnTimer > 0.8 && hearts.length < 10){ spawnHeart(); spawnTimer = 0; }

  // check collisions
  for(let i = hearts.length-1; i>=0; i--){
    const h = hearts[i];
    if(dist(player.x,player.y,h.x,h.y) < h.r + 10){
      // collect
      hearts.splice(i,1);
      score++; scoreEl.innerText = score;
      playBeep();
      floatScore('+1', player.x, player.y - 20);
      // burst particles
      for(let k=0;k<18;k++) addParticle(h.x, h.y, (Math.random()-0.5)*4, (Math.random()-0.5)*4, '#ff2bd4', 40);
    }
  }

  // win condition
  if(score >= targetScore){ running = false; endGame(); }
}

function draw(){
  // clear
  ctx.clearRect(0,0,WIDTH,HEIGHT);

  // background subtle grid
  ctx.save();
  const g1 = ctx.createLinearGradient(0,0,WIDTH,HEIGHT);
  g1.addColorStop(0, 'rgba(10,6,20,0.12)'); g1.addColorStop(1,'rgba(10,6,20,0.06)');
  ctx.fillStyle = g1; ctx.fillRect(0,0,WIDTH,HEIGHT);

  // draw moving trails (soft blur)
  for(let t of trails){ ctx.globalAlpha = t.a*0.7; ctx.fillStyle = 'rgba(120,40,255,0.18)'; ctx.beginPath(); ctx.ellipse(t.x, t.y, 10*(t.a+0.2), 6*(t.a+0.2), 0,0,Math.PI*2); ctx.fill(); }

  // particles
  for(let p of particles){
    const a = 1 - p.age/p.life; ctx.globalAlpha = a; ctx.fillStyle = p.col;
    ctx.beginPath(); ctx.arc(p.x, p.y, Math.max(1, 3*(1-a)), 0, Math.PI*2); ctx.fill();
  }

  // hearts with glow and rotation
  for(let h of hearts){ h.angle += 0.02; drawHeartShape(h.x, h.y, h.r, h.glow); }

  // draw bike (player)
  drawBike(player.x, player.y, player.angle);

  ctx.globalAlpha = 1;
  ctx.restore();
}

// game loop
let lastTime = 0;
function loop(ts){ if(!running) return; const dt = (ts - lastTime)/1000; lastTime = ts; update(dt); draw(); requestAnimationFrame(loop); }

function startGame(){ score = 0; hearts = []; particles = []; trails = []; scoreEl.innerText = score; spawnTimer = 0; running = true; startOverlay.style.display='none'; winOverlay.style.display='none'; howOverlay.style.display='none'; floatContainer.innerHTML='';
  // ensure audio context resume on user gesture
  audioCtx.resume().catch(()=>{});
  if(!musicPlaying){ bgMusic.play().catch(()=>{}); musicPlaying=true; musicBtn.innerText='Pause Kannamma ‚è∏Ô∏è'; }
  // show touch controls on small screens
  if(window.innerWidth <= 720) touchControls.style.display='flex'; else touchControls.style.display='none';
  lastTime = performance.now(); requestAnimationFrame(loop);
}

function endGame(){ running = false; winOverlay.style.display='flex'; // stop music optional
}

startBtn.addEventListener('click', ()=>{ startGame(); });
howBtn.addEventListener('click', ()=>{ howOverlay.style.display='flex'; });
closeHow.addEventListener('click', ()=>{ howOverlay.style.display='none'; });
playAgain.addEventListener('click', ()=>{ startGame(); });

// start paused until user clicks start
// initial canvas sizing
resizeCanvas();
// center player to new dims
player.x = WIDTH/2; player.y = HEIGHT/2;

// initial spawn some hearts
for(let i=0;i<5;i++) spawnHeart();

// make sure touch controls are clickable on mobile
['touchstart','touchend'].forEach(e=>{ document.addEventListener(e, function(ev){ ev.preventDefault && ev.preventDefault(); }, {passive:false}); });

// generate a soft intro animation for the start overlay (cosmetic)
(function introPulse(){ const el = document.querySelector('.title'); if(el){ el.animate([{filter:'drop-shadow(0 0 6px rgba(106,0,255,0.25))'},{filter:'drop-shadow(0 0 26px rgba(106,0,255,0.45))'}],{duration:1800,iterations:Infinity,direction:'alternate'}); } })();

// small resize observer to keep player in bounds
new ResizeObserver(()=>{ resizeCanvas(); player.x = Math.max(20, Math.min(WIDTH-20, player.x)); player.y = Math.max(20, Math.min(HEIGHT-20, player.y)); }).observe(stage);

// optional: allow clicking canvas to nudge music context activation
canvas.addEventListener('click', ()=>{ audioCtx.resume().catch(()=>{}); });

// polish: subtle floating heart background drawn on separate layer (lighter)
(function floatingBackground(){
  const bgCanvas = document.createElement('canvas'); bgCanvas.style.position='absolute'; bgCanvas.style.left=0; bgCanvas.style.top=0; bgCanvas.style.width='100%'; bgCanvas.style.height='100%'; bgCanvas.style.zIndex=5; bgCanvas.style.pointerEvents='none'; bgCanvas.width = canvas.width; bgCanvas.height = canvas.height; stage.appendChild(bgCanvas);
  const bctx = bgCanvas.getContext('2d'); function resizeBG(){ bgCanvas.width = canvas.width; bgCanvas.height = canvas.height; }
  window.addEventListener('resize', resizeBG);
  let floats = [];
  for(let i=0;i<18;i++) floats.push({x:Math.random()*WIDTH,y:Math.random()*HEIGHT,r:8+Math.random()*30,spd:0.1+Math.random()*0.4,angle:Math.random()*Math.PI*2});
  function bgLoop(){ bctx.clearRect(0,0,bgCanvas.width,bgCanvas.height); for(let f of floats){ f.y -= f.spd; f.angle += 0.002; if(f.y < -60) f.y = bgCanvas.height + 60; const a = 0.06 + 0.06*Math.sin(f.angle*2); bctx.beginPath(); bctx.fillStyle = `rgba(170,80,255,${a})`; bctx.ellipse(f.x,f.y,f.r*0.8,f.r*0.45,0,0,Math.PI*2); bctx.fill(); } requestAnimationFrame(bgLoop); }
  bgLoop();
})();

</script>
</body>
</html>
